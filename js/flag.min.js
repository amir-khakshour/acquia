!function(a){Drupal.flagLink=function(b){function c(b,c){var e=a(c);a(".flag-message",e).css("display","none");var f=e.is("a")?e:a("a.flag",e);f.addClass("flag-processed").click(d);a(b);return Drupal.attachBehaviors(e.get(0)),a(".flag-message",e).fadeIn(),setTimeout(function(){a(".flag-message.flag-auto-remove",e).fadeOut()},3e3),e.get(0)}function d(b){b.preventDefault();var d=this,e=a(d).parents(".flag-wrapper");return 0==e.length&&(e=a(d)),e.is(".flag-waiting")?!1:(e.addClass("flag-waiting"),a("span.flag-message:visible").fadeOut(),void a.ajax({type:"POST",url:d.href,data:{js:!0},dataType:"json",success:function(b){b.link=e.get(0),a.event.trigger("flagGlobalBeforeLinkUpdate",[b]),b.preventDefault||(b.link=c(d,b.newLink));var f=a(".flag-link-"+b.contentId),g=a(b.newLink);a(".flag-message",g).hide(),f=g.replaceAll(f),Drupal.attachBehaviors(f.parent()),a.event.trigger("flagGlobalAfterLinkUpdate",[b])},error:function(a){alert("An HTTP error "+a.status+" occurred.\n"+d.href),e.removeClass("flag-waiting")}}))}a("a.flag-link-toggle:not(.flag-processed)",b).addClass("flag-processed").click(d)},Drupal.flagAnonymousLinks=function(b){a("a.flag:not(.flag-anonymous-processed)",b).each(function(){this.href+=(this.href.match(/\?/)?"&":"?")+"has_js=1",a(this).addClass("flag-anonymous-processed")})},String.prototype.flagNameToCSS=function(){return this.replace(/_/g,"-")},Drupal.flagAnonymousLinkTemplates=function(b){var c=Drupal.settings.flag.templates,d=Drupal.flagCookie("flags");if(d){d=d.split("+");for(var e in d){var f=d[e].match(/(\w+)_(\d+)/),g=f[1],h=f[2];c[g+"_"+h]&&a(".flag-"+g.flagNameToCSS()+"-"+h,b).after(c[g+"_"+h]).remove()}}var i=document.cookie.match(/flag_global_(\w+)_(\d+)=([01])/g);if(i)for(var e in i){var f=i[e].match(/flag_global_(\w+)_(\d+)=([01])/),g=f[1],h=f[2],j="1"==f[3]?"flag":"unflag";c[g+"_"+h]&&a(".flag-"+g.flagNameToCSS()+"-"+h,b).each(function(){a(this).find("."+j+"-action").size()&&a(this).after(c[g+"_"+h]).remove()})}},Drupal.flagCookie=function(b,c,d){if("undefined"==typeof c){var e=null;if(document.cookie&&""!=document.cookie)for(var f=document.cookie.split(";"),g=0;g<f.length;g++){var h=jQuery.trim(f[g]);if(h.substring(0,b.length+1)==b+"="){e=decodeURIComponent(h.substring(b.length+1));break}}return e}d=d||{},null===c&&(c="",d=a.extend({},d),d.expires=-1);var i="";if(d.expires&&("number"==typeof d.expires||d.expires.toUTCString)){var j;"number"==typeof d.expires?(j=new Date,j.setTime(j.getTime()+24*d.expires*60*60*1e3)):j=d.expires,i="; expires="+j.toUTCString()}var k=d.path?"; path="+d.path:"",l=d.domain?"; domain="+d.domain:"",m=d.secure?"; secure":"";document.cookie=[b,"=",encodeURIComponent(c),i,k,l,m].join("")},Drupal.behaviors.flagLink={},Drupal.behaviors.flagLink.attach=function(a){Drupal.settings.flag&&Drupal.settings.flag.templates&&Drupal.flagAnonymousLinkTemplates(a),Drupal.settings.flag&&Drupal.settings.flag.anonymous&&Drupal.flagAnonymousLinks(a),Drupal.flagLink(a)}}(jQuery);