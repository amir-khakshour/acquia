!function(a){namespace("Drupal.media.browser"),Drupal.behaviors.mediaLibrary={attach:function(b,c){var d=Drupal.settings.media.browser.library,e=new Drupal.media.browser.library(d),f=a("#scrollbox");a("#media-browser-tabset").bind("tabsshow tabsactivate",function(b,c){var g=c.newPanel||a(c.panel);"media-tab-library"===g.attr("id")&&(e.start(g,d),f.bind("scroll",e,e.scrollUpdater))})}},Drupal.media.browser.library=function(b){this.settings=Drupal.media.browser.library.getDefaults(),a.extend(this.settings,b),this.done=!1,this.cursor=0,this.mediaFiles=[],this.selectedMediaFiles=[]},Drupal.media.browser.library.getDefaults=function(){return{emtpyMessage:Drupal.t("There is nothing in your media library. Select the Upload tab above to add a file."),limit:15}},Drupal.media.browser.library.prototype.start=function(a,b){this.renderElement=a,this.params=b,b.multiselect?this.clickFunction=this.multiSelect:this.clickFunction=this.singleSelect,this.loadMedia()},Drupal.media.browser.library.prototype.loadMedia=function(){var b=this;a("#status").text(Drupal.t("Loading...")).show(),a.extend(this.params,{start:this.cursor,limit:this.settings.limit});var c=function(c,d){a("#status").text("").hide(),c.media.length<b.params.limit&&a("#scrollbox").unbind("scroll"),b.mediaFiles=b.mediaFiles.concat(c.media),b.render(b.renderElement),b.loading=!1},d=function(){alert(Drupal.t("Error getting media."))};a.ajax({url:this.settings.getMediaUrl,type:"GET",dataType:"json",data:this.params,error:d,success:c})},Drupal.media.browser.library.prototype.scrollUpdater=function(a){if(!a.data.loading){var b=document.getElementById("scrollbox"),c=b.scrollTop,d=b.scrollHeight,e=b.clientHeight,f=20;c>=d-(e+f)&&(a.data.loading=!0,a.data.loadMedia())}},Drupal.media.browser.library.prototype.getNextMedia=function(){if(this.cursor>=this.mediaFiles.length)return!1;var a=this.mediaFiles[this.cursor];return this.cursor+=1,a},Drupal.media.browser.library.prototype.render=function(b){if(this.mediaFiles.length<1)return void a('<div id="media-empty-message" class="media-empty-message"></div>').appendTo(b).html(this.emptyMessage);var c=a("#media-browser-library-list",b);if(0===c.length)throw"Cannot continue, list element is missing";for(;this.cursor<this.mediaFiles.length;){var d=this.getNextMedia(),e={};e.obj=this,e.file=d;a("<li></li>").appendTo(c).attr("id","media-item-"+d.fid).html(d.preview).bind("click",e,this.clickFunction)}},Drupal.media.browser.library.prototype.mediaSelected=function(a){Drupal.media.browser.selectMedia(a)},Drupal.media.browser.library.prototype.singleSelect=function(b){var c=b.data.obj;b.data.file;return b.preventDefault(),b.stopPropagation(),a(".media-item").removeClass("selected"),a(".media-item",a(this)).addClass("selected"),c.mediaSelected([b.data.file]),!1},Drupal.media.browser.library.prototype.multiSelect=function(b){var c=b.data.obj,d=b.data.file;b.preventDefault(),b.stopPropagation(),a(".media-item",a(this)).toggleClass("selected");var e=a.inArray(d,c.selectedMediaFiles);return-1==e?c.selectedMediaFiles.push(d):c.selectedMediaFiles.splice(e,1),c.mediaSelected(c.selectedMediaFiles),!1}}(jQuery);